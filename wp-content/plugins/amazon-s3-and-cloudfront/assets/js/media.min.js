var test={};!function(e,t){var a=wp.media,i=a.view.Attachment.Details.TwoColumn;a.view.Attachment.Details.TwoColumn=i.extend({events:function(){return t.extend({},i.prototype.events,{"click .local-warning":"confirmS3Removal","click #as3cfpro-toggle-acl":"toggleACL"})},render:function(){this.fetchS3Details(this.model.get("id"))},fetchS3Details:function(e){wp.ajax.send("as3cf_get_attachment_provider_details",{data:{_nonce:as3cf_media.nonces.get_attachment_provider_details,id:e}}).done(t.bind(this.renderView,this))},renderView:function(e){i.prototype.render.apply(this),this.renderActionLinks(e),this.renderS3Details(e)},renderActionLinks:function(a){var i=a&&a.links||[],r=this.$el.find(".actions"),n=e("<div />",{class:"s3-actions"}),l=[];t(i).each(function(e){l.push(e)}),n.append(l.join(" | ")),r.append(n)},renderS3Details:function(e){if(e&&e.provider_object){var t=this.$el.find(".attachment-info .details"),a=this.generateDetails(e,["provider_name","region","bucket","key","acl","is_verified"]);t.append(a)}},generateDetails:function(e,a){var i="",r=t.template('<div class="<%= key %>"><strong><%= label %>:</strong> <%= value %></div>');return t(a).each(function(a){if(e.provider_object[a]){var n=e.provider_object[a];if("acl"===a)if(n=e.provider_object[a].name,e.acl_toggle)n=t.template('<a href="#" id="as3cfpro-toggle-acl" title="<%= title %>" data-currentACL="<%= acl %>"><%= value %></a>')({title:e.provider_object[a].title,acl:e.provider_object[a].acl,value:n});if("is_verified"===a){if(n=Boolean(parseInt(n)))return;n=as3cf_media.strings.not_verified}i+=r({key:a,label:as3cf_media.strings[a],value:n})}}),i},confirmS3Removal:function(e){if(!confirm(as3cfpro_media.strings.local_warning))return e.preventDefault(),e.stopImmediatePropagation(),!1},toggleACL:function(a){a.preventDefault();var i=e("#as3cfpro-toggle-acl"),r=i.data("currentacl"),n=as3cfpro_media.settings.private_acl;i.hide(),i.after('<span id="as3cfpro-updating">'+as3cfpro_media.strings.updating_acl+"</span>"),r===as3cfpro_media.settings.private_acl&&(n=as3cfpro_media.settings.default_acl),wp.ajax.send("as3cfpro_update_acl",{data:{_ajax_nonce:as3cfpro_media.nonces.singular_update_acl,id:this.model.get("id"),acl:n}}).done(t.bind(this.updateACL,this)).fail(t.bind(this.renderACLError,this))},renderACLError:function(){e("#as3cfpro-updating").remove(),e("#as3cfpro-toggle-acl").show(),alert(as3cfpro_media.strings.change_acl_error)},updateACL:function(t){if(null!=t.acl_display&&null!=t.title&&null!=t.acl&&null!=t.url){this.model.set("url",t.url),this.render();var a=e("#as3cfpro-toggle-acl");e("#as3cfpro-updating").remove(),a.text(t.acl_display),a.attr("title",t.title),a.data("currentacl",t.acl),a.show()}else this.renderACLError()}})}(jQuery,_);